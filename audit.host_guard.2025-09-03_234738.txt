=== Host Guard / Admin Auth Audit @ 2025-09-03_234738 ===
MAIN_HOST=swaeduae.ae
ADMIN_HOST=admin.swaeduae.ae

== A) Route cache + environment ==

  GET|HEAD        / .......................................................................................................................................................... generated::JBwKvUCT7CJOMVK7
APP_URL=https://swaeduae.ae
SESSION_DOMAIN=.swaeduae.ae
SESSION_SECURE_COOKIE=true

== B) Top guard presence & normalization ==
<?php

// ==== FORCE admin paths to admin subdomain (TOP GUARD) ====
\Illuminate\Support\Facades\Route::domain(env('MAIN_DOMAIN','swaeduae.ae'))->middleware(['web'])->group(function(){
   \Illuminate\Support\Facades\Route::any('/admin{any?}', function ($any = null) {
        $target = 'https://' . env('ADMIN_DOMAIN','admin.swaeduae.ae') . '/admin' . ($any ? '/' . ltrim($any,'/') : '');
        return redirect()->away($target, 301);
    })->where('any','.*')->name('main.admin.redirect');
});
use App\Http\Controllers\Auth\AuthenticatedSessionController;
use Illuminate\Support\Facades\Session;
use App\Http\Controllers\Public\OpportunityController;
use App\Http\Controllers\Public\ApplyController;
use Illuminate\Support\Facades\Route;


Route::get('/partners', function(){ return view('public.partners'); })->name('partners.index');
use App\Http\Controllers\CertificatePdfController;

Route::middleware(['web','auth','verified'])->group(function () {

PASS: top guard present and normalizing '$any'

== C) Admin routes: ensure auth + can:access-admin ==
Admin routes missing AUTH:
 - admin.dashboard admin
 - admin.diag.whoami admin/_whoami
 - admin.applicants.index admin/applicants
 - admin.applicants.bulk admin/applicants/bulk
 - admin.applicants.export admin/applicants/export
 - admin.applicants.approve admin/applicants/{id}/approve
 - admin.applicants.decline admin/applicants/{id}/decline
 - admin.attendance.index admin/attendance
 - admin.certs.index admin/certificates
 - admin.certs.issue admin/certificates/issue
 - admin.certs.reissue admin/certificates/{id}/reissue
 - admin.hours.bulkApprove admin/hours/bulk-approve
 - admin.hours.export admin/hours/export
 - admin.login admin/login
 - admin.opportunities.index admin/opportunities
 - admin.opportunities.show admin/opportunities/{opportunity}
 - admin.opportunities.save admin/opportunities/{opportunity}
 - admin.generated::UTriaIVaaTRmFXj3 admin/opportunities/{opportunity}
 - admin.opportunities.destroy admin/opportunities/{opportunity}
 - admin.opportunities.update admin/opportunities/{opportunity}
 - admin.organizations.index admin/organizations
 - admin.organizations.approve admin/organizations/{id}/approve
 - admin.organizations.suspend admin/organizations/{id}/suspend
 - admin.reports.index admin/reports
 - admin.reports.export admin/reports/export
 - admin.settings.index admin/settings
 - admin.settings.save admin/settings/save
 - admin.users.index admin/users
 - admin.users.show admin/users/{user}
 - admin.users.save admin/users/{user}
 - admin. admin/users/{user}
 - admin.users.destroy admin/users/{user}
 - admin.users.update admin/users/{user}
Admin routes missing can:access-admin:
 - admin.dashboard admin
 - admin.diag.whoami admin/_whoami
 - admin.applicants.index admin/applicants
 - admin.applicants.bulk admin/applicants/bulk
 - admin.applicants.export admin/applicants/export
 - admin.applicants.approve admin/applicants/{id}/approve
 - admin.applicants.decline admin/applicants/{id}/decline
 - admin.attendance.index admin/attendance
 - admin.certs.index admin/certificates
 - admin.certs.issue admin/certificates/issue
 - admin.certs.reissue admin/certificates/{id}/reissue
 - admin.hours.bulkApprove admin/hours/bulk-approve
 - admin.hours.export admin/hours/export
 - admin.login admin/login
 - admin.opportunities.index admin/opportunities
 - admin.opportunities.show admin/opportunities/{opportunity}
 - admin.opportunities.save admin/opportunities/{opportunity}
 - admin.generated::UTriaIVaaTRmFXj3 admin/opportunities/{opportunity}
 - admin.opportunities.destroy admin/opportunities/{opportunity}
 - admin.opportunities.update admin/opportunities/{opportunity}
 - admin.organizations.index admin/organizations
 - admin.organizations.approve admin/organizations/{id}/approve
 - admin.organizations.suspend admin/organizations/{id}/suspend
 - admin.reports.index admin/reports
 - admin.reports.export admin/reports/export
 - admin.settings.index admin/settings
 - admin.settings.save admin/settings/save
 - admin.users.index admin/users
 - admin.users.show admin/users/{user}
 - admin.users.save admin/users/{user}
 - admin. admin/users/{user}
 - admin.users.destroy admin/users/{user}
 - admin.users.update admin/users/{user}

== D) HTTP probes (admin host) ==
https://admin.swaeduae.ae/admin               -> 302
https://admin.swaeduae.ae/admin/login         -> 302
https://admin.swaeduae.ae/admin/users         -> 302
https://admin.swaeduae.ae/admin/organizations -> 302
https://admin.swaeduae.ae/admin/settings      -> 302

== E) HTTP probes (main host should redirect /admin* to admin host) ==
https://swaeduae.ae/admin               -> 301   Location: https://admin.swaeduae.ae/admin
https://swaeduae.ae/admin/login         -> 301   Location: https://admin.swaeduae.ae/admin/login
https://swaeduae.ae/admin/users         -> 301   Location: https://admin.swaeduae.ae/admin/users

== F) Admin login page sanity (CSRF + form action) ==
18:    <input type="hidden" name="_token" value="Npq3Zi85RvSFZ8MnHYLBSMJQSi4v1etvzKAJ1ik7" autocomplete="off">    <label>Email</label>
Form actions:
"https://admin.swaeduae.ae/login"

== G) Main-site volunteer/org login pages (should be 200) ==
https://swaeduae.ae/login               -> 200
https://swaeduae.ae/register            -> 200
https://swaeduae.ae/org/login           -> 200
https://swaeduae.ae/org/register        -> 200

=== SUMMARY ===
Report saved to: audit.host_guard.2025-09-03_234738.txt
