<?php

use Illuminate\Support\Facades\Route;
use Illuminate\Http\Request;

Route::get('_agent/ping', function (Request $request) {
    if (!env('AGENT_ENABLED', false)) {
        abort(404); // off = not visible
    }
    $token = env('AGENT_TOKEN');
    if (!$token) {
        abort(403); // misconfigured
    }
    $supplied = $request->header('X-Agent-Token');
    if (!hash_equals($token, (string) $supplied)) {
        abort(401); // auth required
    }
    return response()->json([
        'ok' => true,
        'ts' => now()->toIso8601String(),
        'app' => config('app.name'),
        'env' => app()->environment(),
    ]);
})->name('agent.ping');
